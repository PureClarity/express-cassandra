'use strict';

var tryRequire = require('try-require');

var dseDriver = tryRequire('dse-driver');

var check = require('check-types');
var util = require('util');
var cql = dseDriver || require('cassandra-driver');

var validators = {};
validators.is_array = function (obj) {
  return check.array(obj);
};
validators.is_object = function (obj) {
  return check.object(obj);
};
validators.is_long = function (obj) {
  return obj instanceof cql.types.Long;
};
validators.is_decimal = function (obj) {
  return obj instanceof cql.types.BigDecimal;
};
validators.is_integer = function (obj) {
  return check.intNumber(obj);
};
validators.is_var_int = function (obj) {
  return obj instanceof cql.types.Integer;
};
validators.is_boolean = function (obj) {
  return obj === true || obj === false;
};
validators.is_number = function (obj) {
  return check.number(obj);
};
validators.is_string = function (obj) {
  return check.string(obj);
};
validators.is_local_date = function (obj) {
  return obj instanceof cql.types.LocalDate;
};
validators.is_local_time = function (obj) {
  return obj instanceof cql.types.LocalTime;
};
validators.is_date = function (obj) {
  return check.date(new Date(obj));
};
validators.is_buffer = function (obj) {
  return obj instanceof Buffer;
};
validators.is_timeuuid = function (obj) {
  return obj instanceof cql.types.TimeUuid;
};
validators.is_uuid = function (obj) {
  return obj instanceof cql.types.Uuid;
};
validators.is_inet = function (obj) {
  return obj instanceof cql.types.InetAddress;
};
validators.is_frozen = function (obj) {
  return validators.is_array(obj) || validators.is_object(obj);
};

var TYPE_MAP = {
  ascii: { validator: validators.is_string },
  bigint: { validator: validators.is_long },
  blob: { validator: validators.is_buffer },
  boolean: { validator: validators.is_boolean },
  counter: { validator: validators.is_long },
  date: { validator: validators.is_local_date },
  decimal: { validator: validators.is_decimal },
  double: { validator: validators.is_number },
  float: { validator: validators.is_number },
  inet: { validator: validators.is_inet },
  int: { validator: validators.is_integer },
  list: { validator: validators.is_array },
  map: { validator: validators.is_object },
  set: { validator: validators.is_array },
  smallint: { validator: validators.is_integer },
  text: { validator: validators.is_string },
  time: { validator: validators.is_local_time },
  timestamp: { validator: validators.is_date },
  timeuuid: { validator: validators.is_timeuuid },
  tinyint: { validator: validators.is_integer },
  uuid: { validator: validators.is_uuid },
  varchar: { validator: validators.is_string },
  varint: { validator: validators.is_var_int },
  frozen: { validator: validators.is_frozen }
};

TYPE_MAP.generic_type_validator = function f(fieldtype) {
  if (!this[fieldtype]) return null;

  return {
    validator: this[fieldtype].validator,
    message: function message(value, propName, fieldType) {
      return util.format('Invalid Value: "%s" for Field: %s (Type: %s)', value, propName, fieldType);
    },

    type: 'type_validator'
  };
};

TYPE_MAP.extract_type = function f(val) {
  // decompose composite types
  var decomposed = val ? val.replace(/[\s]/g, '').split(/[<,>]/g) : [''];

  for (var d = 0; d < decomposed.length; d++) {
    if (Object.keys(this).indexOf(decomposed[d]) > -1) {
      return decomposed[d];
    }
  }

  return val;
};

TYPE_MAP.extract_typeDef = function f(val) {
  // decompose composite types
  var decomposed = val ? val.replace(/[\s]/g, '') : '';
  decomposed = decomposed.substr(decomposed.indexOf('<'), decomposed.length - decomposed.indexOf('<'));

  return decomposed;
};

module.exports = TYPE_MAP;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9vcm0vY2Fzc2FuZHJhX3R5cGVzLmpzIl0sIm5hbWVzIjpbInRyeVJlcXVpcmUiLCJyZXF1aXJlIiwiZHNlRHJpdmVyIiwiY2hlY2siLCJ1dGlsIiwiY3FsIiwidmFsaWRhdG9ycyIsImlzX2FycmF5Iiwib2JqIiwiYXJyYXkiLCJpc19vYmplY3QiLCJvYmplY3QiLCJpc19sb25nIiwidHlwZXMiLCJMb25nIiwiaXNfZGVjaW1hbCIsIkJpZ0RlY2ltYWwiLCJpc19pbnRlZ2VyIiwiaW50TnVtYmVyIiwiaXNfdmFyX2ludCIsIkludGVnZXIiLCJpc19ib29sZWFuIiwiaXNfbnVtYmVyIiwibnVtYmVyIiwiaXNfc3RyaW5nIiwic3RyaW5nIiwiaXNfbG9jYWxfZGF0ZSIsIkxvY2FsRGF0ZSIsImlzX2xvY2FsX3RpbWUiLCJMb2NhbFRpbWUiLCJpc19kYXRlIiwiZGF0ZSIsIkRhdGUiLCJpc19idWZmZXIiLCJCdWZmZXIiLCJpc190aW1ldXVpZCIsIlRpbWVVdWlkIiwiaXNfdXVpZCIsIlV1aWQiLCJpc19pbmV0IiwiSW5ldEFkZHJlc3MiLCJpc19mcm96ZW4iLCJUWVBFX01BUCIsImFzY2lpIiwidmFsaWRhdG9yIiwiYmlnaW50IiwiYmxvYiIsImJvb2xlYW4iLCJjb3VudGVyIiwiZGVjaW1hbCIsImRvdWJsZSIsImZsb2F0IiwiaW5ldCIsImludCIsImxpc3QiLCJtYXAiLCJzZXQiLCJzbWFsbGludCIsInRleHQiLCJ0aW1lIiwidGltZXN0YW1wIiwidGltZXV1aWQiLCJ0aW55aW50IiwidXVpZCIsInZhcmNoYXIiLCJ2YXJpbnQiLCJmcm96ZW4iLCJnZW5lcmljX3R5cGVfdmFsaWRhdG9yIiwiZiIsImZpZWxkdHlwZSIsIm1lc3NhZ2UiLCJ2YWx1ZSIsInByb3BOYW1lIiwiZmllbGRUeXBlIiwiZm9ybWF0IiwidHlwZSIsImV4dHJhY3RfdHlwZSIsInZhbCIsImRlY29tcG9zZWQiLCJyZXBsYWNlIiwic3BsaXQiLCJkIiwibGVuZ3RoIiwiT2JqZWN0Iiwia2V5cyIsImluZGV4T2YiLCJleHRyYWN0X3R5cGVEZWYiLCJzdWJzdHIiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOztBQUFBLElBQU1BLGFBQWFDLFFBQVEsYUFBUixDQUFuQjs7QUFFQSxJQUFNQyxZQUFZRixXQUFXLFlBQVgsQ0FBbEI7O0FBRUEsSUFBTUcsUUFBUUYsUUFBUSxhQUFSLENBQWQ7QUFDQSxJQUFNRyxPQUFPSCxRQUFRLE1BQVIsQ0FBYjtBQUNBLElBQU1JLE1BQU1ILGFBQWFELFFBQVEsa0JBQVIsQ0FBekI7O0FBRUEsSUFBTUssYUFBYSxFQUFuQjtBQUNBQSxXQUFXQyxRQUFYLEdBQXNCLFVBQUNDLEdBQUQ7QUFBQSxTQUFVTCxNQUFNTSxLQUFOLENBQVlELEdBQVosQ0FBVjtBQUFBLENBQXRCO0FBQ0FGLFdBQVdJLFNBQVgsR0FBdUIsVUFBQ0YsR0FBRDtBQUFBLFNBQVVMLE1BQU1RLE1BQU4sQ0FBYUgsR0FBYixDQUFWO0FBQUEsQ0FBdkI7QUFDQUYsV0FBV00sT0FBWCxHQUFxQixVQUFDSixHQUFEO0FBQUEsU0FBV0EsZUFBZUgsSUFBSVEsS0FBSixDQUFVQyxJQUFwQztBQUFBLENBQXJCO0FBQ0FSLFdBQVdTLFVBQVgsR0FBd0IsVUFBQ1AsR0FBRDtBQUFBLFNBQVdBLGVBQWVILElBQUlRLEtBQUosQ0FBVUcsVUFBcEM7QUFBQSxDQUF4QjtBQUNBVixXQUFXVyxVQUFYLEdBQXdCLFVBQUNULEdBQUQ7QUFBQSxTQUFVTCxNQUFNZSxTQUFOLENBQWdCVixHQUFoQixDQUFWO0FBQUEsQ0FBeEI7QUFDQUYsV0FBV2EsVUFBWCxHQUF3QixVQUFDWCxHQUFEO0FBQUEsU0FBV0EsZUFBZUgsSUFBSVEsS0FBSixDQUFVTyxPQUFwQztBQUFBLENBQXhCO0FBQ0FkLFdBQVdlLFVBQVgsR0FBd0IsVUFBQ2IsR0FBRDtBQUFBLFNBQVdBLFFBQVEsSUFBUixJQUFnQkEsUUFBUSxLQUFuQztBQUFBLENBQXhCO0FBQ0FGLFdBQVdnQixTQUFYLEdBQXVCLFVBQUNk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QUEyQixTQUFTbEIsQ0FBVCxDQUFXUyxHQUFYLEVBQWdCO0FBQ3pDO0FBQ0EsTUFBSUMsYUFBYUQsTUFBTUEsSUFBSUUsT0FBSixDQUFZLE9BQVosRUFBcUIsRUFBckIsQ0FBTixHQUFpQyxFQUFsRDtBQUNBRCxlQUFhQSxXQUFXUyxNQUFYLENBQWtCVCxXQUFXTyxPQUFYLENBQW1CLEdBQW5CLENBQWxCLEVBQTJDUCxXQUFXSSxNQUFYLEdBQW9CSixXQUFXTyxPQUFYLENBQW1CLEdBQW5CLENBQS9ELENBQWI7O0FBRUEsU0FBT1AsVUFBUDtBQUNELENBTkQ7O0FBUUFVLE9BQU9DLE9BQVAsR0FBaUIvQyxRQUFqQiIsImZpbGUiOiJjYXNzYW5kcmFfdHlwZXMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCB0cnlSZXF1aXJlID0gcmVxdWlyZSgndHJ5LXJlcXVpcmUnKTtcblxuY29uc3QgZHNlRHJpdmVyID0gdHJ5UmVxdWlyZSgnZHNlLWRyaXZlcicpO1xuXG5jb25zdCBjaGVjayA9IHJlcXVpcmUoJ2NoZWNrLXR5cGVzJyk7XG5jb25zdCB1dGlsID0gcmVxdWlyZSgndXRpbCcpO1xuY29uc3QgY3FsID0gZHNlRHJpdmVyIHx8IHJlcXVpcmUoJ2Nhc3NhbmRyYS1kcml2ZXInKTtcblxuY29uc3QgdmFsaWRhdG9ycyA9IHt9O1xudmFsaWRhdG9ycy5pc19hcnJheSA9IChvYmopID0+IChjaGVjay5hcnJheShvYmopKTtcbnZhbGlkYXRvcnMuaXNfb2JqZWN0ID0gKG9iaikgPT4gKGNoZWNrLm9iamVjdChvYmopKTtcbnZhbGlkYXRvcnMuaXNfbG9uZyA9IChvYmopID0+ICgob2JqIGluc3RhbmNlb2YgY3FsLnR5cGVzLkxvbmcpKTtcbnZhbGlkYXRvcnMuaXNfZGVjaW1hbCA9IChvYmopID0+ICgob2JqIGluc3RhbmNlb2YgY3FsLnR5cGVzLkJpZ0RlY2ltYWwpKTtcbnZhbGlkYXRvcnMuaXNfaW50ZWdlciA9IChvYmopID0+IChjaGVjay5pbnROdW1iZXIob2JqKSk7XG52YWxpZGF0b3JzLmlzX3Zhcl9pbnQgPSAob2JqKSA9PiAoKG9iaiBpbnN0YW5jZW9mIGNxbC50eXBlcy5JbnRlZ2VyKSk7XG52YWxpZGF0b3JzLmlzX2Jvb2xlYW4gPSAob2JqKSA9PiAoKG9iaiA9PT0gdHJ1ZSB8fCBvYmogPT09IGZhbHNlKSk7XG52YWxpZGF0b3JzLmlzX251bWJlciA9IChvYmopID0+IChjaGVjay5udW1iZXIob2JqKSk7XG52YWxpZGF0b3JzLmlzX3N0cmluZyA9IChvYmopID0+IChjaGVjay5zdHJpbmcob2JqKSk7XG52YWxpZGF0b3JzLmlzX2xvY2FsX2RhdGUgPSAob2JqKSA9PiAoKG9iaiBpbnN0YW5jZW9mIGNxbC50eXBlcy5Mb2NhbERhdGUpKTtcbnZhbGlkYXRvcnMuaXNfbG9jYWxfdGltZSA9IChvYmopID0+ICgob2JqIGluc3RhbmNlb2YgY3FsLnR5cGVzLkxvY2FsVGltZSkpO1xudmFsaWRhdG9ycy5pc19kYXRlID0gKG9iaikgPT4gKGNoZWNrLmRhdGUobmV3IERhdGUob2JqKSkpO1xudmFsaWRhdG9ycy5pc19idWZmZXIgPSAob2JqKSA9PiAoKG9iaiBpbnN0YW5jZW9mIEJ1ZmZlcikpO1xudmFsaWRhdG9ycy5pc190aW1ldXVpZCA9IChvYmopID0+ICgob2JqIGluc3RhbmNlb2YgY3FsLnR5cGVzLlRpbWVVdWlkKSk7XG52YWxpZGF0b3JzLmlzX3V1aWQgPSAob2JqKSA9PiAoKG9iaiBpbnN0YW5jZW9mIGNxbC50eXBlcy5VdWlkKSk7XG52YWxpZGF0b3JzLmlzX2luZXQgPSAob2JqKSA9PiAoKG9iaiBpbnN0YW5jZW9mIGNxbC50eXBlcy5JbmV0QWRkcmVzcykpO1xudmFsaWRhdG9ycy5pc19mcm96ZW4gPSAob2JqKSA9PiAoKHZhbGlkYXRvcnMuaXNfYXJyYXkob2JqKSB8fCB2YWxpZGF0b3JzLmlzX29iamVjdChvYmopKSk7XG5cbmNvbnN0IFRZUEVfTUFQID0ge1xuICBhc2NpaTogeyB2YWxpZGF0b3I6IHZhbGlkYXRvcnMuaXNfc3RyaW5nIH0sXG4gIGJpZ2ludDogeyB2YWxpZGF0b3I6IHZhbGlkYXRvcnMuaXNfbG9uZyB9LFxuICBibG9iOiB7IHZhbGlkYXRvcjogdmFsaWRhdG9ycy5pc19idWZmZXIgfSxcbiAgYm9vbGVhbjogeyB2YWxpZGF0b3I6IHZhbGlkYXRvcnMuaXNfYm9vbGVhbiB9LFxuICBjb3VudGVyOiB7IHZhbGlkYXRvcjogdmFsaWRhdG9ycy5pc19sb25nIH0sXG4gIGRhdGU6IHsgdmFsaWRhdG9yOiB2YWxpZGF0b3JzLmlzX2xvY2FsX2RhdGUgfSxcbiAgZGVjaW1hbDogeyB2YWxpZGF0b3I6IHZhbGlkYXRvcnMuaXNfZGVjaW1hbCB9LFxuICBkb3VibGU6IHsgdmFsaWRhdG9yOiB2YWxpZGF0b3JzLmlzX251bWJlciB9LFxuICBmbG9hdDogeyB2YWxpZGF0b3I6IHZhbGlkYXRvcnMuaXNfbnVtYmVyIH0sXG4gIGluZXQ6IHsgdmFsaWRhdG9yOiB2YWxpZGF0b3JzLmlzX2luZXQgfSxcbiAgaW50OiB7IHZhbGlkYXRvcjogdmFsaWRhdG9ycy5pc19pbnRlZ2VyIH0sXG4gIGxpc3Q6IHsgdmFsaWRhdG9yOiB2YWxpZGF0b3JzLmlzX2FycmF5IH0sXG4gIG1hcDogeyB2YWxpZGF0b3I6IHZhbGlkYXRvcnMuaXNfb2JqZWN0IH0sXG4gIHNldDogeyB2YWxpZGF0b3I6IHZhbGlkYXRvcnMuaXNfYXJyYXkgfSxcbiAgc21hbGxpbnQ6IHsgdmFsaWRhdG9yOiB2YWxpZGF0b3JzLmlzX2ludGVnZXIgfSxcbiAgdGV4dDogeyB2YWxpZGF0b3I6IHZhbGlkYXRvcnMuaXNfc3RyaW5nIH0sXG4gIHRpbWU6IHsgdmFsaWRhdG9yOiB2YWxpZGF0b3JzLmlzX2xvY2FsX3RpbWUgfSxcbiAgdGltZXN0YW1wOiB7IHZhbGlkYXRvcjogdmFsaWRhdG9ycy5pc19kYXRlIH0sXG4gIHRpbWV1dWlkOiB7IHZhbGlkYXRvcjogdmFsaWRhdG9ycy5pc190aW1ldXVpZCB9LFxuICB0aW55aW50OiB7IHZhbGlkYXRvcjogdmFsaWRhdG9ycy5pc19pbnRlZ2VyIH0sXG4gIHV1aWQ6IHsgdmFsaWRhdG9yOiB2YWxpZGF0b3JzLmlzX3V1aWQgfSxcbiAgdmFyY2hhcjogeyB2YWxpZGF0b3I6IHZhbGlkYXRvcnMuaXNfc3RyaW5nIH0sXG4gIHZhcmludDogeyB2YWxpZGF0b3I6IHZhbGlkYXRvcnMuaXNfdmFyX2ludCB9LFxuICBmcm96ZW46IHsgdmFsaWRhdG9yOiB2YWxpZGF0b3JzLmlzX2Zyb3plbiB9LFxufTtcblxuXG5UWVBFX01BUC5nZW5lcmljX3R5cGVfdmFsaWRhdG9yID0gZnVuY3Rpb24gZihmaWVsZHR5cGUpIHtcbiAgaWYgKCF0aGlzW2ZpZWxkdHlwZV0pIHJldHVybiBudWxsO1xuXG4gIHJldHVybiB7XG4gICAgdmFsaWRhdG9yOiB0aGlzW2ZpZWxkdHlwZV0udmFsaWRhdG9yLFxuICAgIG1lc3NhZ2UodmFsdWUsIHByb3BOYW1lLCBmaWVsZFR5cGUpIHtcbiAgICAgIHJldHVybiB1dGlsLmZvcm1hdCgnSW52YWxpZCBWYWx1ZTogXCIlc1wiIGZvciBGaWVsZDogJXMgKFR5cGU6ICVzKScsIHZhbHVlLCBwcm9wTmFtZSwgZmllbGRUeXBlKTtcbiAgICB9LFxuICAgIHR5cGU6ICd0eXBlX3ZhbGlkYXRvcicsXG4gIH07XG59O1xuXG5UWVBFX01BUC5leHRyYWN0X3R5cGUgPSBmdW5jdGlvbiBmKHZhbCkge1xuICAvLyBkZWNvbXBvc2UgY29tcG9zaXRlIHR5cGVzXG4gIGNvbnN0IGRlY29tcG9zZWQgPSB2YWwgPyB2YWwucmVwbGFjZSgvW1xcc10vZywgJycpLnNwbGl0KC9bPCw+XS9nKSA6IFsnJ107XG5cbiAgZm9yIChsZXQgZCA9IDA7IGQgPCBkZWNvbXBvc2VkLmxlbmd0aDsgZCsrKSB7XG4gICAgaWYgKE9iamVjdC5rZXlzKHRoaXMpLmluZGV4T2YoZGVjb21wb3NlZFtkXSkgPiAtMSkge1xuICAgICAgcmV0dXJuIGRlY29tcG9zZWRbZF07XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHZhbDtcbn07XG5cblRZUEVfTUFQLmV4dHJhY3RfdHlwZURlZiA9IGZ1bmN0aW9uIGYodmFsKSB7XG4gIC8vIGRlY29tcG9zZSBjb21wb3NpdGUgdHlwZXNcbiAgbGV0IGRlY29tcG9zZWQgPSB2YWwgPyB2YWwucmVwbGFjZSgvW1xcc10vZywgJycpIDogJyc7XG4gIGRlY29tcG9zZWQgPSBkZWNvbXBvc2VkLnN1YnN0cihkZWNvbXBvc2VkLmluZGV4T2YoJzwnKSwgZGVjb21wb3NlZC5sZW5ndGggLSBkZWNvbXBvc2VkLmluZGV4T2YoJzwnKSk7XG5cbiAgcmV0dXJuIGRlY29tcG9zZWQ7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFRZUEVfTUFQO1xuIl19